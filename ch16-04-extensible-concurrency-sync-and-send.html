<!DOCTYPE HTML>
<html lang="fa" class="light sidebar-visible" dir="rtl">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>همزمانی قابل گسترش با صفت‌های Sync و Send - The Rust Programming Language</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="ferris.css">
        <link rel="stylesheet" href="theme/2018-edition.css">
        <link rel="stylesheet" href="theme/semantic-notes.css">
        <link rel="stylesheet" href="theme/listing.css">
        <link rel="stylesheet" href="theme/custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust Programming Language</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/persian-rust/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="همروندی-توسعهپذیر-با-traitهای-send-و-sync"><a class="header" href="#همروندی-توسعهپذیر-با-traitهای-send-و-sync">هم‌روندی توسعه‌پذیر با <code>trait</code>‌های <code>Send</code> و <code>Sync</code></a></h2>
<!-- Old link, do not remove -->
<p><a id="extensible-concurrency-with-the-sync-and-send-traits"></a></p>
<p>جالب است که تقریباً تمام ویژگی‌های هم‌روندی که تا این‌جای فصل درباره‌شان صحبت کردیم، بخشی از کتابخانه‌ی استاندارد بوده‌اند، نه زبان. گزینه‌های شما برای مدیریت هم‌روندی محدود به زبان یا کتابخانه‌ی استاندارد نیست؛ می‌توانید ویژگی‌های هم‌روندی خود را بنویسید یا از آن‌هایی استفاده کنید که دیگران نوشته‌اند.</p>
<p>با این حال، در میان مفاهیم کلیدی هم‌روندی که در خود زبان (و نه در کتابخانه‌ی استاندارد) گنجانده شده‌اند، <code>trait</code>‌های <code>std::marker</code> یعنی <code>Send</code> و <code>Sync</code> قرار دارند.</p>
<h3 id="اجازه-انتقال-مالکیت-بین-نخها-با-send"><a class="header" href="#اجازه-انتقال-مالکیت-بین-نخها-با-send">اجازه انتقال مالکیت بین نخ‌ها با <code>Send</code></a></h3>
<p><code>trait</code> نشانه‌گذاری‌شده‌ی <code>Send</code> مشخص می‌کند که مالکیت مقادیر نوعی که این <code>trait</code> را پیاده‌سازی کرده، می‌تواند بین نخ‌ها منتقل شود. تقریباً همه‌ی نوع‌های Rust، <code>Send</code> را پیاده‌سازی می‌کنند، اما برخی استثناها نیز وجود دارند؛ از جمله <code>Rc&lt;T&gt;</code>: این نوع نمی‌تواند <code>Send</code> را پیاده‌سازی کند، چرا که اگر یک مقدار <code>Rc&lt;T&gt;</code> را clone کنید و بخواهید مالکیت آن را به نخ دیگری منتقل کنید، ممکن است هر دو نخ هم‌زمان شمارنده‌ی رفرنس را به‌روزرسانی کنند. به همین دلیل، <code>Rc&lt;T&gt;</code> برای استفاده در موقعیت‌های تک‌نخی طراحی شده است، جایی که نمی‌خواهید هزینه‌ی عملکردی مرتبط با ایمنی نخ را بپردازید.</p>
<p>بنابراین، سیستم نوع Rust و محدودیت‌های <code>trait</code> تضمین می‌کنند که هرگز به‌طور ناخواسته نتوانید یک مقدار <code>Rc&lt;T&gt;</code> را به‌شکل ناایمن بین نخ‌ها منتقل کنید. زمانی که سعی کردیم این کار را در لیستینگ 16-14 انجام دهیم، خطایی دریافت کردیم با این مضمون که <code>trait `Send` برای `Rc&lt;Mutex&lt;i32&gt;&gt;` پیاده‌سازی نشده است</code>. اما زمانی که به <code>Arc&lt;T&gt;</code> تغییر دادیم، که <code>Send</code> را پیاده‌سازی می‌کند، کد با موفقیت کامپایل شد.</p>
<p>هر نوعی که به‌طور کامل از نوع‌های <code>Send</code> تشکیل شده باشد به‌طور خودکار به عنوان
<code>Send</code> علامت‌گذاری می‌شود. تقریباً تمام نوع‌های اولیه <code>Send</code> هستند، به جز
اشاره‌گر (Pointer)های خام، که در فصل 20 درباره آن‌ها صحبت خواهیم کرد.</p>
<h3 id="اجازه-دسترسی-از-چندین-نخ-با-sync"><a class="header" href="#اجازه-دسترسی-از-چندین-نخ-با-sync">اجازه دسترسی از چندین نخ با <code>Sync</code></a></h3>
<p><code>trait</code> نشانه‌گذاری‌شده‌ی <code>Sync</code> مشخص می‌کند که ارجاع دادن به نوعی که این <code>trait</code> را پیاده‌سازی کرده از چندین نخ به‌صورت هم‌زمان بی‌خطر است. به‌عبارت دیگر، هر نوعی <code>T</code> زمانی <code>Sync</code> را پیاده‌سازی می‌کند که <code>&amp;T</code> (یک رفرنس غیرقابل تغییر به <code>T</code>) <code>Send</code> را پیاده‌سازی کرده باشد، یعنی این رفرنس می‌تواند با اطمینان به نخ دیگری ارسال شود. مشابه <code>Send</code>، تمام نوع‌های اولیه (<code>primitive types</code>) <code>Sync</code> را پیاده‌سازی می‌کنند، و نوع‌هایی که به‌طور کامل از نوع‌هایی تشکیل شده‌اند که خود <code>Sync</code> هستند، نیز به‌طور خودکار <code>Sync</code> را پیاده‌سازی می‌کنند.</p>
<p>اشاره‌گر هوشمند <code>Rc&lt;T&gt;</code> نیز برای همان دلایلی که <code>Send</code> را پیاده‌سازی نمی‌کند، <code>Sync</code> را نیز پیاده‌سازی نمی‌کند. نوع <code>RefCell&lt;T&gt;</code> (که در فصل ۱۵ درباره‌ی آن صحبت کردیم) و خانواده‌ی نوع‌های مرتبط با <code>Cell&lt;T&gt;</code> نیز <code>Sync</code> را پیاده‌سازی نمی‌کنند. پیاده‌سازی بررسی وام‌گیری (<code>borrow checking</code>) که <code>RefCell&lt;T&gt;</code> در زمان اجرا انجام می‌دهد، برای نخ‌های مختلف ایمن نیست. اشاره‌گر هوشمند <code>Mutex&lt;T&gt;</code> <code>Sync</code> را پیاده‌سازی می‌کند و می‌تواند برای اشتراک‌گذاری دسترسی بین چندین نخ استفاده شود، همان‌طور که در [«اشتراک‌گذاری یک <code>Mutex&lt;T&gt;</code> بین چند نخ»][sharing-a-mutext-between-multiple-threads]<!-- ignore --> مشاهده کردید.</p>
<h3 id="پیادهسازی-دستی-send-و-sync-ناایمن-است"><a class="header" href="#پیادهسازی-دستی-send-و-sync-ناایمن-است">پیاده‌سازی دستی <code>Send</code> و <code>Sync</code> ناایمن است</a></h3>
<p>از آن‌جا که نوع‌هایی که به‌طور کامل از نوع‌های دیگری تشکیل شده‌اند که خودشان <code>Send</code> و <code>Sync</code> را پیاده‌سازی کرده‌اند، به‌صورت خودکار این دو <code>trait</code> را پیاده‌سازی می‌کنند، نیازی به پیاده‌سازی دستی آن‌ها نداریم. به‌عنوان <code>marker trait</code>‌ها، این <code>trait</code>‌ها حتی هیچ متدی برای پیاده‌سازی ندارند. آن‌ها فقط برای اعمال کردن محدودیت‌هایی مرتبط با هم‌زمانی مفید هستند.</p>
<p>پیاده‌سازی دستی این ویژگی‌ها شامل پیاده‌سازی کد ناایمن در راست می‌شود. ما در فصل
20 درباره استفاده از کد ناایمن در راست صحبت خواهیم کرد؛ فعلاً، اطلاعات مهم این
است که ساخت نوع‌های همزمان جدید که از قسمت‌های <code>Send</code> و <code>Sync</code> تشکیل نشده‌اند
نیاز به دقت زیادی دارد تا اصول ایمنی رعایت شوند. <a href="../nomicon/index.html">“The Rustonomicon”</a>
اطلاعات بیشتری درباره این اصول و نحوه رعایت آن‌ها ارائه می‌دهد.</p>
<h2 id="خلاصه"><a class="header" href="#خلاصه">خلاصه</a></h2>
<p>این آخرین باری نیست که در این کتاب با هم‌زمانی (concurrency) روبه‌رو می‌شوید: فصل بعدی بر برنامه‌نویسی async تمرکز دارد و پروژه‌ی فصل ۲۱ مفاهیم این فصل را در یک موقعیت واقعی‌تر نسبت به مثال‌های کوچکی که در این‌جا بررسی شد به‌کار خواهد گرفت.</p>
<p>همانطور که قبلاً اشاره شد، به دلیل اینکه بخش بسیار کمی از نحوه مدیریت همزمانی در راست
بخشی از زبان است، بسیاری از راه‌حل‌های همزمانی به‌عنوان crate پیاده‌سازی شده‌اند.
این‌ها سریع‌تر از کتابخانه استاندارد تکامل می‌یابند، بنابراین حتماً به صورت آنلاین جستجو
کنید تا crate‌های به‌روز و پیشرفته‌ای که برای موقعیت‌های چندریسمانی مناسب هستند را پیدا کنید.</p>
<p>کتابخانه استاندارد راست کانال‌هایی برای ارسال پیام و انواع اسمارت پوینتر، مانند <code>Mutex&lt;T&gt;</code>
و <code>Arc&lt;T&gt;</code>، فراهم می‌کند که استفاده از آن‌ها در زمینه‌های همزمان ایمن است. سیستم نوعی
و کنترل‌کننده وام‌دهی تضمین می‌کنند که کدی که از این راه‌حل‌ها استفاده می‌کند با رقابت‌های
داده یا ارجاع‌های نامعتبر مواجه نمی‌شود. هنگامی که کد شما کامپایل شود، می‌توانید مطمئن
باشید که بدون آن دسته از اشکال‌های سخت‌ردیابی که در زبان‌های دیگر معمول است، به خوبی
روی چندین نخ اجرا خواهد شد. برنامه‌نویسی همزمان دیگر مفهومی برای ترسیدن نیست:
پیش بروید و برنامه‌های خود را بی‌باکانه همزمان کنید!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="ch16-03-shared-state.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="ch17-00-async-await.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="ch16-03-shared-state.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="ch17-00-async-await.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="ferris.js"></script>



    </div>
    </body>
</html>
